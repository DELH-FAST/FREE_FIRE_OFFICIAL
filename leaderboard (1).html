<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FFH Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body { background:#111; color:#fff; font-family:Arial; text-align:center; padding:20px; }
  table { width:100%; border-collapse:collapse; margin-top:20px; background:#222; }
  th, td { padding:10px; border:1px solid #444; }
  th { background:#333; color:gold; }
  tr:nth-child(even) { background:#1a1a1a; }
  input, button { padding:8px; margin:5px; border-radius:5px; }
  button { cursor:pointer; }
</style>
</head>

<body>

<h1>üèÜ Free Fire Hosters Leaderboard</h1>

<!-- üîê Admin Login -->
<div id="adminLogin">
  <h3>üîê Admin Login</h3>
  <input type="password" id="adminPass" placeholder="Enter Admin Password">
  <button onclick="checkAdmin()">Login</button>
</div>

<!-- ‚úèÔ∏è Admin Panel -->
<div id="adminPanel" style="display:none; margin-top:30px;">
  <h3>‚úèÔ∏è Add / Edit / Delete Player</h3>
  <input id="pname" placeholder="Player Name">
  <input id="puid" placeholder="Free Fire UID">
  <input id="kills" type="number" placeholder="Kills">
  <input id="points" type="number" placeholder="Points">
  <input id="matchRank" placeholder="Match Rank (optional)">
  <br>
  <button onclick="addOrUpdatePlayer()">Save</button>
  <button onclick="deletePlayer()">Delete</button>
</div>

<!-- üîç Search -->
<input id="searchInput" placeholder="Search by name or UID">

<!-- üìä Table -->
<table>
  <thead>
    <tr>
      <th>Rank</th>
      <th>Name</th>
      <th>UID</th>
      <th>Kills</th>
      <th>Points</th>
      <th>Certificate</th>
    </tr>
  </thead>
  <tbody id="leaderboardBody"></tbody>
</table>

<!-- üî• Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  var firebaseConfig = {
    apiKey: "AIzaSyDu63aBnziCht_cxsWhyXrnM7Q6Qu9pQdU",
    authDomain: "ffh-leaderboard.firebaseapp.com",
    databaseURL: "https://ffh-leaderboard-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "ffh-leaderboard",
    storageBucket: "ffh-leaderboard.appspot.com",
    messagingSenderId: "741775542110",
    appId: "1:741775542110:web:081728ad509b75bbf3f1cf"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<!-- üèÜ Leaderboard Logic -->
<script>
  db.ref("leaderboard").on("value", snapshot => {
    const data = snapshot.val() || {};
    const players = Object.values(data);

    // ü•á Sort: Points (DESC) ‚Üí Optional Kills (DESC)
    players.sort((a, b) =>
      (b.points || 0) - (a.points || 0) ||
      (b.kills || 0) - (a.kills || 0)
    );

    const body = document.getElementById("leaderboardBody");
    body.innerHTML = "";

    players.forEach((player, index) => {
      const rank = index + 1;
      body.innerHTML += `
        <tr>
          <td>${rank}</td>
          <td>${player.name}</td>
          <td>${player.uid}</td>
          <td>${player.kills}</td>
          <td>${player.points}</td>
          <td>
            <button onclick="downloadCertificate(
              '${player.name}',
              '${player.uid}',
              '${player.matchRank || "N/A"}',
              '${rank}',
              '${player.kills}'
            )">Download</button>
          </td>
        </tr>
      `;
    });
  });

  // üîç Search
  document.getElementById("searchInput").addEventListener("input", function () {
    const val = this.value.toLowerCase();
    document.querySelectorAll("#leaderboardBody tr").forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(val) ? "" : "none";
    });
  });
</script>

<!-- ‚úèÔ∏è Admin Functions (FIXED) -->
<script>
  function checkAdmin() {
    if (document.getElementById("adminPass").value === "FFDATALB") {
      document.getElementById("adminLogin").style.display = "none";
      document.getElementById("adminPanel").style.display = "block";
    } else {
      alert("‚ùå Wrong password");
    }
  }

  function addOrUpdatePlayer() {
    const nameVal = document.getElementById("pname").value;
    const uidVal = document.getElementById("puid").value;
    const killsVal = Number(document.getElementById("kills").value) || 0;
    const pointsVal = Number(document.getElementById("points").value) || 0;
    const matchRankVal = document.getElementById("matchRank").value || "";

    if (!nameVal || !uidVal) {
      alert("Name & UID required");
      return;
    }

    db.ref("leaderboard/" + uidVal).set({
      name: nameVal,
      uid: uidVal,
      kills: killsVal,
      points: pointsVal,
      matchRank: matchRankVal
    }, err => {
      alert(err ? "‚ùå Save failed" : "‚úÖ Player saved");
    });
  }

  function deletePlayer() {
    const uidVal = document.getElementById("puid").value;
    if (!uidVal) {
      alert("Enter UID to delete");
      return;
    }

    db.ref("leaderboard/" + uidVal).remove(err => {
      alert(err ? "‚ùå Delete failed" : "‚úÖ Player deleted");
    });
  }
</script>

<!-- üìú Certificate -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  function downloadCertificate(name, uid, matchRank, rank, kills) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("landscape");

    doc.setFontSize(28);
    doc.text("Free Fire Hosters Tournament", 148, 40, { align:"center" });
    doc.setFontSize(18);
    doc.text(`Name: ${name}`, 148, 70, { align:"center" });
    doc.text(`UID: ${uid}`, 148, 85, { align:"center" });
    doc.text(`Rank: ${rank}`, 148, 100, { align:"center" });
    doc.text(`Kills: ${kills}`, 148, 115, { align:"center" });
    doc.text(`Match Rank: ${matchRank}`, 148, 130, { align:"center" });

    doc.save(`Certificate_${name}.pdf`);
  }
</script>

</body>
</html>